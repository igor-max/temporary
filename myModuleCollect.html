<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <script>

    const obj = {
      state: {
        count: 1
      },
      mutations: {
        SET_COUNT(state) {
          state.count += 2;
        }
      },
      getters: {
        getCount(state) {
          return state.count + 'lalala';
        }
      },
      actions: {
        setCount({ commit }) {
          commit('SET_COUNT');
        }
      },
      modules: {
        a: {
          namespaced: true,
          state: {
            count: 'a'
          },
          mutations: {
            SET_COUNT(state) {
              state.count += 2;
            }
          },
          getters: {
            getCount(state) {
              return state.count + 'lalala';
            }
          },
          actions: {
            setCount1({ commit }) {
              commit('SET_COUNT');
            }
          },
          modules: {
            aa: {
              namespaced: true,
              state: {
                count: 'aa'
              },
              mutations: {
                SET_COUNT(state) {
                  state.count += 2;
                }
              },
              getters: {
                getCount(state) {
                  return state.count + 'lalala';
                }
              },
              actions: {
                setCount2({ commit }) {
                  commit('SET_COUNT');
                }
              },
              modules: {
                aaa: {
                  namespaced: true,
                  state: {
                    count: 'aaa'
                  },
                  mutations: {
                    SET_COUNT(state) {
                      state.count += 2;
                    }
                  },
                  getters: {
                    getCount(state) {
                      return state.count + 'lalala';
                    }
                  },
                  actions: {
                    setCount3({ commit }) {
                      commit('SET_COUNT');
                    }
                  },
                  modules: {
                    aaaa: {
                      namespaced: true,
                      state: {
                        count: 'aaaa'
                      },
                      mutations: {
                        SET_COUNT(state) {
                          state.count += 2;
                        }
                      },
                      getters: {
                        getCount(state) {
                          return state.count + 'lalala';
                        }
                      },
                      actions: {
                        setCount4({ commit }) {
                          commit('SET_COUNT');
                        }
                      },
                    }
                  }
                }
              }
            }
          }
        },
        b: {
          state: {},
          modules: {
            bb: {}
          }
        }
      }
    }

    // tree -> tree
    class Module {
      constructor(module) {
        this._rawModule = module;
        this._children = Object.create(null);  // 指针
        this.state = module.state || {};
      }
    }

    class ModuleCollection {
      constructor(rootModule) {
        this.root = new Module(rootModule);
        this.register(this.root);
      }

      register(parent) {
        const childModules = parent._rawModule.modules;
        if (!childModules) return;
        Object.keys(childModules).forEach(key => this.register(parent._children[key] = new Module(childModules[key])));
      }
    }

    const mc = new ModuleCollection(obj);
    console.log(mc);
  </script>
</body>

</html>